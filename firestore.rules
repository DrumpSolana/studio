
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // --- Businesses/Users Rules ---
    // A user can create a document for themselves, and only they can
    // read, update, or delete their own document.
    // Admin can read all businesses (for admin dashboard)
    match /businesses/{businessId} {
      allow create: if request.auth != null && request.auth.uid == businessId;
      allow read: if true; // Allow anyone to read businesses (for admin dashboard)
      allow update, delete: if request.auth != null && request.auth.uid == businessId;
    }

    // --- Pre-orders Rules ---
    // Anyone (signed-in or not) can create a pre-order.
    // No one can read, update, or delete pre-orders to protect privacy.
    match /pre-orders/{orderId} {
      allow create: if true;
      allow read, update, delete: if false;
    }

     // --- Admins Rules ---
    // Only authenticated users can create admin accounts
    // Only the admin themselves can read/update their own admin document
    match /admins/{adminId} {
      allow create: if request.auth != null && request.auth.uid == adminId;
      allow read, update: if request.auth != null && request.auth.uid == adminId;
      allow delete: if false; // Prevent deletion of admin accounts
    }

     // --- Test Entries Rules ---
    // Anyone can write to the test collection for debugging purposes.
    match /test-entries/{docId} {
      allow create, read: if true;
      allow update, delete: if false;
    }
  }
}

    